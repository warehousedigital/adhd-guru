<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mental Dump â†’ Timeline (AI)</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5f5f5;
      padding: 2rem;
      max-width: 700px;
      margin: 0 auto;
    }
    h1 {
      color: #2c3e50;
      font-size: 1.8rem;
    }
    textarea, input, select, button {
      width: 100%;
      margin: 0.5rem 0 1rem 0;
      font-size: 1rem;
      padding: 0.75rem;
      border-radius: 0.4rem;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background: #2c3e50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #1a242f;
    }
    .inline {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .inline input[type="number"] {
      flex: 2;
      min-width: 120px;
    }
    .inline select {
      flex: 1;
      min-width: 120px;
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      margin: 0;
    }
    .output {
      background: white;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      white-space: pre-wrap;
    }
    .loading {
      font-style: italic;
      color: #999;
    }
  </style>
</head>
<body>

  <h1>ðŸ§  Mental Dump â†’ Timeline (AI-Powered)</h1>
  <p>Tell me everything you need to do and how you're feeling. Then enter the time youâ€™ve got, and Iâ€™ll help you plan what to do â€” in what order â€” with honesty, kindness, and a bit of tough love.</p>

  <label for="freeform">Whatâ€™s on your mind?</label>
  <textarea id="freeform" rows="7" placeholder="e.g. I need to finish edits, clean the kitchen, email Jo, and I'm really burned out. I have 3 hours but I keep putting everything off. The video edits are most urgent. I keep forgetting food."></textarea>

  <label>How much time do you have?</label>
  <div class="inline">
    <input type="number" id="timeAmount" min="1" placeholder="e.g. 3" />
    <select id="timeUnit">
      <option value="minutes">Minutes</option>
      <option value="hours">Hours</option>
      <option value="days">Days (8 working hours)</option>
    </select>
  </div>

  <button onclick="submitToAI()">Make My Plan</button>

  <div class="output" id="output"></div>

  <script>
    async function submitToAI() {
      const text = document.getElementById("freeform").value.trim();
      const amount = document.getElementById("timeAmount").value.trim();
      const unit = document.getElementById("timeUnit").value;
      const output = document.getElementById("output");

      if (!text || !amount || isNaN(amount)) {
        output.innerHTML = "<p>Please enter your thoughts and how much time you have.</p>";
        return;
      }

      let adjustedHours;
      if (unit === "minutes") {
        adjustedHours = (parseFloat(amount) / 60).toFixed(2);
      } else if (unit === "hours") {
        adjustedHours = parseFloat(amount);
      } else if (unit === "days") {
        adjustedHours = parseFloat(amount) * 8; // 1 day = 8 hours of work time
      }

      const prompt = `
You are a task planning assistant helping someone with ADHD and executive dysfunction. 
You are kind, supportive, but firm. You do not guess or make vague assumptions. 
Be honest, direct, and specific. The user has provided the following unstructured input:

"${text}"

They have approximately ${adjustedHours} hours available.

Your job is to:
1. Parse and list the distinct tasks
2. Estimate a realistic time for each (in minutes)
3. Prioritise based on urgency, importance, and emotional tone
4. Fit them into a clear timeline with suggested breaks, meals, and downtime if needed
5. Provide a brief motivational explanation at the end ("Why this order?", "Why now?")

Assume 1 day = 8 hours. Respect their energy level and make sure the plan is actionable.
Return your response as a readable block of text, not JSON or lists.
`;

      output.innerHTML = "<p class='loading'>Thinkingâ€¦ building your timelineâ€¦</p>";

      try {
        const response = await fetch("https://shy-poetry-c035.peter-775.workers.dev", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ input: prompt })
        });

        const data = await response.json();
        output.innerHTML = `<div>${data.plan}</div>`;
      } catch (err) {
        output.innerHTML = `<p>Error: ${err.message}</p>`;
      }
    }
  </script>

</body>
</html>
